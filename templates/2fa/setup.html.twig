<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Activer 2FA | ClutchX</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ asset('assets/css/bootstrap-lib/bootstrap.min.css') }}">
    <link rel="stylesheet" href="{{ asset('assets/font-awesome-lib/icon/font-awesome.min.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        *, *::before, *::after { box-sizing: border-box; }
        html, body { height: 100%; margin: 0; font-family: 'Inter', sans-serif; overflow-x: hidden; }

        .bg-video { position: fixed; inset: 0; z-index: 0; }
        .bg-video video { width: 100%; height: 100%; object-fit: cover; }
        .bg-video .overlay { position: absolute; inset: 0; background: linear-gradient(160deg, rgba(16,10,46,0.88) 0%, rgba(30,10,60,0.92) 100%); }

        .page { position: relative; z-index: 2; display: flex; justify-content: center; align-items: center; min-height: 100vh; padding: 40px 16px; }

        .card {
            width: 100%; max-width: 480px;
            background: rgba(255,255,255,0.06); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.1); border-radius: 20px;
            padding: 36px 32px 28px; color: #fff;
            box-shadow: 0 24px 64px rgba(0,0,0,0.4);
        }

        .card-header { text-align: center; margin-bottom: 28px; }
        .card-header .icon-circle {
            width: 64px; height: 64px;
            background: linear-gradient(135deg, #7c3aed, #a855f7);
            border-radius: 50%; display: inline-flex; align-items: center; justify-content: center;
            margin-bottom: 14px; font-size: 1.6rem;
        }
        .card-header h2 { font-size: 1.5rem; font-weight: 700; margin: 0 0 4px; }
        .card-header p { font-size: 0.85rem; color: rgba(255,255,255,0.55); margin: 0; }

        .steps { margin-bottom: 24px; }
        .step { display: flex; align-items: flex-start; gap: 12px; margin-bottom: 16px; }
        .step-number {
            min-width: 28px; height: 28px;
            background: rgba(168,85,247,0.15); border: 1px solid rgba(168,85,247,0.3);
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-size: 0.75rem; font-weight: 700; color: #c084fc;
        }
        .step-text { font-size: 0.88rem; color: rgba(255,255,255,0.75); line-height: 1.5; padding-top: 3px; }
        .step-text strong { color: #fff; }

        .qr-wrap {
            text-align: center; margin: 24px 0;
            padding: 20px; background: #fff; border-radius: 12px;
            display: inline-block; margin-left: auto; margin-right: auto;
        }
        .qr-center { display: flex; justify-content: center; }
        .qr-wrap img { display: block; }

        .secret-box {
            margin: 16px 0 24px;
            padding: 12px 16px;
            background: rgba(255,255,255,0.06);
            border: 1px solid rgba(255,255,255,0.12);
            border-radius: 10px;
            text-align: center;
        }
        .secret-box label { display: block; font-size: 0.72rem; color: rgba(255,255,255,0.45); text-transform: uppercase; letter-spacing: 0.06em; margin-bottom: 6px; }
        .secret-box code { font-size: 1rem; font-weight: 600; color: #e9d5ff; letter-spacing: 0.15em; word-break: break-all; }

        .field-group { margin-bottom: 18px; }
        .field-group label {
            display: block; font-size: 0.78rem; font-weight: 500;
            color: rgba(255,255,255,0.7); margin-bottom: 6px;
            letter-spacing: 0.02em; text-transform: uppercase;
        }
        .field-group input {
            width: 100%; padding: 13px 14px; border-radius: 10px;
            border: 1.5px solid rgba(255,255,255,0.12);
            background: rgba(255,255,255,0.07); color: #fff;
            font-size: 1.1rem; font-family: 'Inter', monospace;
            outline: none; transition: border-color 0.25s, box-shadow 0.25s;
            text-align: center; letter-spacing: 0.3em; font-weight: 600;
        }
        .field-group input::placeholder { color: rgba(255,255,255,0.3); letter-spacing: 0.2em; }
        .field-group input:focus { border-color: #a855f7; background: rgba(255,255,255,0.1); box-shadow: 0 0 0 3px rgba(168,85,247,0.15); }

        .btn-submit {
            width: 100%; padding: 13px; border: none; border-radius: 12px;
            background: linear-gradient(135deg, #7c3aed, #a855f7);
            color: #fff; font-size: 0.95rem; font-weight: 600; font-family: inherit;
            cursor: pointer; transition: transform 0.2s, box-shadow 0.2s;
        }
        .btn-submit:hover { transform: translateY(-2px); box-shadow: 0 12px 32px rgba(124,58,237,0.35); }

        .btn-back {
            display: block; text-align: center; margin-top: 16px;
            color: rgba(255,255,255,0.5); font-size: 0.84rem; text-decoration: none;
            transition: color 0.2s;
        }
        .btn-back:hover { color: #c084fc; }

        .flash-msg {
            display: flex; align-items: flex-start; gap: 8px; margin-bottom: 18px;
            padding: 12px 16px; border-radius: 10px;
        }
        .flash-error { background: rgba(239,68,68,0.12); border: 1px solid rgba(239,68,68,0.25); }
        .flash-error i { color: #f87171; margin-top: 2px; }
        .flash-error span { color: #fca5a5; font-size: 0.85rem; }
        .flash-success { background: rgba(34,197,94,0.12); border: 1px solid rgba(34,197,94,0.25); }
        .flash-success i { color: #86efac; margin-top: 2px; }
        .flash-success span { color: #86efac; font-size: 0.85rem; }

        @media (max-width: 480px) { .card { padding: 28px 20px 22px; border-radius: 16px; } }
    </style>
</head>

<body>

<div class="bg-video">
    <video autoplay loop muted playsinline>
        <source src="{{ asset('assets/images/index/header-video.mp4') }}" type="video/mp4">
    </video>
    <div class="overlay"></div>
</div>

<div class="page">
    <div class="card">

        <div class="card-header">
            <div class="icon-circle">
                <i class="fa fa-shield" style="color:#fff"></i>
            </div>
            <h2>Activer la 2FA</h2>
            <p>Protégez votre compte avec Google Authenticator</p>
        </div>

        {% for message in app.flashes('error') %}
            <div class="flash-msg flash-error">
                <i class="fa fa-exclamation-triangle"></i>
                <span>{{ message }}</span>
            </div>
        {% endfor %}

        <div class="steps">
            <div class="step">
                <div class="step-number">1</div>
                <div class="step-text">Téléchargez <strong>Google Authenticator</strong> sur votre téléphone (iOS / Android).</div>
            </div>
            <div class="step">
                <div class="step-number">2</div>
                <div class="step-text">Scannez le <strong>QR code</strong> ci-dessous avec l'application.</div>
            </div>
            <div class="step">
                <div class="step-number">3</div>
                <div class="step-text">Saisissez le <strong>code à 6 chiffres</strong> affiché dans l'application pour confirmer.</div>
            </div>
        </div>

        <div class="qr-center">
            <div class="qr-wrap">
                <img src="{{ qrCode }}" alt="QR Code 2FA" width="250" height="250">
            </div>
        </div>

        <div class="secret-box">
            <label>Clé secrète (saisie manuelle)</label>
            <code>{{ secret }}</code>
        </div>

        <form method="post" action="{{ path('app_2fa_confirm') }}">
            <input type="hidden" name="secret" value="{{ secret }}">

            <div class="field-group">
                <label for="code">Code de vérification</label>
                <input type="text" id="code" name="code" placeholder="000000" maxlength="6" pattern="[0-9]{6}"
                       inputmode="numeric" autocomplete="one-time-code" required autofocus>
            </div>

            <button type="submit" class="btn-submit">
                <i class="fa fa-check" style="margin-right:6px"></i> Activer la 2FA
            </button>
        </form>

        <a href="javascript:history.back()" class="btn-back">
            <i class="fa fa-arrow-left"></i> Retour au profil
        </a>

    </div>
</div>

</body>
</html>
