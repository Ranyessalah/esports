{% extends 'base.html.twig' %}

{% block body %}

<style>

/* ===== PAGE ===== */
.match-wrapper{
    max-width:1000px;
    margin:50px auto;
    padding:0 20px;
    color:#e5e7eb;
}

/* ===== ARENA CARD ===== */
.match-arena{
    background:
        radial-gradient(circle at top,#1e293b,#020617 70%);
    border-radius:20px;
    padding:40px 35px;
    box-shadow:0 25px 70px rgba(0,0,0,.7);
    position:relative;
    overflow:hidden;
}

/* glow effect */
.match-arena::before{
    content:'';
    position:absolute;
    inset:0;
    background:linear-gradient(120deg,transparent,rgba(139,92,246,.25),transparent);
    opacity:.35;
    pointer-events:none;
}

/* ===== HEADER ===== */
.match-title{
    text-align:center;
    font-weight:700;
    letter-spacing:1px;
    color:#94a3b8;
    margin-bottom:25px;
}

/* ===== STATUS BADGE ===== */
.status-badge{
    position:absolute;
    top:20px;
    right:20px;
    padding:8px 16px;
    border-radius:999px;
    font-size:13px;
    font-weight:700;
}

.status-live{background:#ef4444;color:white;}
.status-finished{background:#22c55e;color:black;}
.status-upcoming{background:#facc15;color:black;}

/* ===== SCOREBOARD ===== */
.scoreboard{
    display:grid;
    grid-template-columns:1fr auto 1fr;
    align-items:center;
    gap:20px;
    margin-top:20px;
}
/* ===== AI LOADER ===== */

.ai-loader{
    display:none;
    position:fixed;
    inset:0;
    background:rgba(2,6,23,.88);
    backdrop-filter:blur(8px);
    z-index:9999;
    justify-content:center;
    align-items:center;
    animation:fadeIn .4s ease;
}

@keyframes fadeIn{
    from{opacity:0}
    to{opacity:1}
}

.ai-card{
    text-align:center;
    padding:40px;
    border-radius:20px;
    background:linear-gradient(145deg,#020617,#1e293b);
    box-shadow:0 0 60px rgba(139,92,246,.6);
    animation:pulse 2s infinite;
}

@keyframes pulse{
    0%{box-shadow:0 0 30px rgba(139,92,246,.4)}
    50%{box-shadow:0 0 70px rgba(236,72,153,.9)}
    100%{box-shadow:0 0 30px rgba(139,92,246,.4)}
}

.ai-gif{
    width:180px;
    margin-bottom:20px;
}

.ai-text{
    font-size:20px;
    font-weight:700;
    color:#e0e7ff;
    margin-bottom:8px;
}

.ai-sub{
    font-size:14px;
    color:#94a3b8;
    letter-spacing:1px;
}

.team{
    text-align:center;
}

/* TEAM CIRCLE */
.team-logo{
    width:90px;
    height:90px;
    border-radius:50%;
    background:#111827;
    border:2px solid #8b5cf6;
    display:flex;
    align-items:center;
    justify-content:center;
    margin:auto;
    font-weight:900;
    font-size:22px;
}

/* TEAM NAME */
.team-name{
    margin-top:12px;
    font-weight:700;
    font-size:18px;
}

/* SCORE */
.score-box{
    text-align:center;
}

.score{
    font-size:64px;
    font-weight:900;
    background:linear-gradient(90deg,#8b5cf6,#ec4899);
    -webkit-background-clip:text;
    color:transparent;
}

.vs{
    color:#64748b;
    font-weight:700;
}

/* ===== COUNTDOWN ===== */
.countdown{
    text-align:center;
    margin-top:25px;
    font-size:18px;
    color:#facc15;
}

/* ===== DETAILS ===== */
.details{
    margin-top:35px;
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
    gap:20px;
}

.detail-card{
    background:#020617;
    border:1px solid rgba(255,255,255,.08);
    border-radius:14px;
    padding:20px;
    text-align:center;
}

.detail-card small{
    color:#94a3b8;
}

.detail-card h4{
    margin-top:6px;
    font-weight:800;
}

/* ===== BUTTONS ===== */
.actions{
    display:flex;
    justify-content:center;
    gap:18px;
    margin-top:35px;
}

.btn-back{
    padding:12px 26px;
    background:#111827;
    border-radius:12px;
    border:1px solid #334155;
    color:#e5e7eb;
    text-decoration:none;
}

.btn-back:hover{background:#1f2937;}

.btn-edit{
    padding:12px 26px;
    border-radius:12px;
    background:linear-gradient(135deg,#8b5cf6,#ec4899);
    color:white;
    text-decoration:none;
    font-weight:600;
}

</style>

<div class="match-wrapper">

<div class="match-arena">

    <!-- STATUS -->
    {% if match.statut == 'EN_COURS' %}
        <div class="status-badge status-live">LIVE</div>
    {% elseif match.statut == 'TERMINE' %}
        <div class="status-badge status-finished">FINISHED</div>
    {% else %}
        <div class="status-badge status-upcoming">UPCOMING</div>
    {% endif %}

    <div class="match-title">
        Match #{{ match.id }}
    </div>

    <!-- SCOREBOARD -->
    <div class="scoreboard">

        <div class="team">
            <div class="team-logo">
                {{ match.equipe1.nom|slice(0,2)|upper }}
            </div>
            <div class="team-name">{{ match.equipe1.nom }}</div>
        </div>

        <div class="score-box">
            <div class="score">
                {{ match.scoreEquipe1 ?? 0 }} : {{ match.scoreEquipe2 ?? 0 }}
            </div>
            <div class="vs">VS</div>
        </div>

        <div class="team">
            <div class="team-logo">
                {{ match.equipe2.nom|slice(0,2)|upper }}
            </div>
            <div class="team-name">{{ match.equipe2.nom }}</div>
        </div>

    </div>

    <!-- COUNTDOWN -->
    {% if match.dateMatch > "now"|date %}
        {% set diff = date(match.dateMatch).diff(date()) %}
        <div class="countdown">
            ‚è≥ Starts in {{ diff.days }} days
        </div>
    {% endif %}

</div>

<!-- DETAILS -->
<div class="details">

    <div class="detail-card">
        <small>Date</small>
        <h4>{{ match.dateMatch|date('d M Y H:i') }}</h4>
    </div>

    <div class="detail-card">
        <small>End</small>
        <h4>{{ match.dateFinMatch|date('d M Y H:i') }}</h4>
    </div>

    <div class="detail-card">
        <small>Status</small>
        <h4>{{ match.statut|replace({'_':' '})|title }}</h4>
    </div>

</div>
<div style="text-align:center;margin-top:30px">

<button id="predictBtn"
style="
padding:14px 28px;
font-size:16px;
font-weight:700;
border:none;
border-radius:14px;
cursor:pointer;
background:linear-gradient(135deg,#ec4899,#8b5cf6);
color:white;
box-shadow:0 10px 25px rgba(0,0,0,.5);
">
ü§ñ Predict Match Result
</button>
<div id="aiLoader" class="ai-loader">
    <div class="ai-card">

        <img src="{{ asset('ia.gif') }}" class="ai-gif">

        <div class="ai-text">
            Artificial Intelligence is analyzing the teams...
        </div>

        <div class="ai-sub">
            Calculating form ‚Ä¢ attack power ‚Ä¢ defense ‚Ä¢ history
        </div>

    </div>
</div>

</div>

<div id="predictionBox" style="display:none;margin-top:30px;"></div>

<div class="actions">


    <a href="{{ path('app_matchs_index') }}" class="btn-back">‚Üê Back</a>

    

    {% if is_granted('ROLE_ADMIN') %}
        <a href="{{ path('app_matchs_edit', {'id': match.id}) }}" class="btn-edit">
            Edit Match
        </a>
    {% endif %}

</div>


</div>
<script>

const btn = document.getElementById('predictBtn');
const box = document.getElementById('predictionBox');
const loader = document.getElementById('aiLoader');

btn.addEventListener('click', async () => {

    // afficher le loader IA
    loader.style.display = "flex";

    btn.innerHTML = "AI thinking...";
    btn.disabled = true;

    try {

        const response = await fetch("{{ path('app_matchs_predict', {id: match.id}) }}");

        const data = await response.json();

        // cacher le loader
        loader.style.display = "none";

        if(data.error){
            box.innerHTML = "<p style='color:red'>"+data.error+"</p>";
        }else{

            box.style.display = "block";

            box.innerHTML = `
            <div style="
                padding:24px;
                border-radius:18px;
                text-align:center;
                background:linear-gradient(135deg,#0ea5e9,#8b5cf6,#ec4899);
                box-shadow:0 0 35px rgba(139,92,246,.7);
                animation:fadeIn .5s ease;
            ">
                <div style="letter-spacing:2px;font-size:14px;color:#e0e7ff">
                    ü§ñ AI MATCH PREDICTION
                </div>

                <div style="font-size:48px;font-weight:900;margin-top:10px">
                    ${data.prediction}
                </div>

                <div style="margin-top:10px;color:#c7d2fe">
                    Generated using Machine Learning
                </div>
            </div>`;
        }

    } catch(e){
        loader.style.display = "none";
        box.innerHTML = "<p style='color:red'>AI Server Error</p>";
    }

    btn.innerHTML = "Predict Again";
    btn.disabled = false;

});

</script>


{% endblock %}
